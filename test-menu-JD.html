<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <script src="jquery-1.12.4.min.js"></script>
    <title>menu-JD</title>
</head>
<style>
    ul{
        margin:0;
        padding:0;
    }
    li{
        padding-left:10px;
        list-style:none;
        cursor:pointer;
    }
    #wrap{
        position:relative;
        top:20px;
        left:20px;
    }
    #main{
        width:200px;
        background-color:#555;
        font-size:14px;
        color:#fff;
    }

    #main>li{
        width:calc(100% - 10px);
        height:30px;
        line-height:30px;
        background-color:#555;
    }

    #main>li.actived{
        background-color:#aaa;
    }

    #main>li>span:hover{
        color:#a33;
    }

    #sub{
        position:absolute;
        top:0;
        left: 200px;
        width:500px;
        background-color:#f5f5f5;
        font-size:12px;
        display:none;
    }

    #sub li{
        display:none;
    }

    #sub dl{
        overflow:hidden;
    }

    #sub dt,#sub dd{
        float:left;
        margin-left:0;
        cursor:pointer;
    }

    #sub dt{
        width:50px;
        margin-right:20px;
    }

    #sub dd{
        padding:0 10px;
        border-left:1px solid #ddd;
    }

    #sub dt>i{
        float:right;
        width:4px;
        height:12px;
    }
</style>
<body>
    <div id="wrap">
        <ul id="main">
            <li data-id="item1"><span>家用电器</span></li>
            <li data-id="item2"><span>手机 / 运营商 / 数码</span></li>
            <li data-id="item3"><span>电脑办公</span></li>
            <li data-id="item4"><span>家居 / 家具 / 家装 / 厨具</span></li>
        </ul>

        <div id="sub">
            <ul>
                <li id="item1">
                    <dl>
                        <dt>电视<i>&gt;</i></dt>
                        <dd>合资品牌</dd>
                        <dd>国产品牌</dd>
                        <dd>互联网品牌</dd>
                        <dd></dd>
                    </dl>
                    <dl>
                        <dt>空调<i>&gt;</i></dt>
                        <dd>壁挂式空调</dd>
                        <dd>柜式空调</dd>
                        <dd>中央空调</dd>
                        <dd>空调配件</dd>
                    </dl>
                    <dl>
                        <dt>洗衣机<i>&gt;</i></dt>
                        <dd>就哈不是</dd>
                        <dd>士大夫但</dd>
                        <dd>啊三分到</dd>
                        <dd>大师傅但</dd>
                    </dl>
                    <dl>
                        <dt>冰箱<i>&gt;</i></dt>
                        <dd>士大夫</dd>
                        <dd>虽然</dd>
                        <dd>是否</dd>
                        <dd>第三方</dd>
                    </dl>
                </li>
                <li id="item2">
                    <dl>
                        <dt>手机<i>&gt;</i></dt>
                        <dd>合资品牌</dd>
                        <dd>国产品牌</dd>
                        <dd>互联网品牌</dd>
                        <dd></dd>
                    </dl>
                    <dl>
                        <dt>运营商<i>&gt;</i></dt>
                        <dd>是士大夫但</dd>
                        <dd>层析成像</dd>
                        <dd>vxcv</dd>
                        <dd>从v从</dd>
                    </dl>
                    <dl>
                        <dt>数码<i>&gt;</i></dt>
                        <dd>吃饭v</dd>
                        <dd>胜多负少</dd>
                        <dd>飒飒</dd>
                        <dd>撒</dd>
                    </dl>
                </li>
                <li id="item3">
                        <dl>
                        <dt>Pad<i>&gt;</i></dt>
                        <dd>合资品牌</dd>
                        <dd>撒旦撒旦</dd>
                        <dd>互联网品牌</dd>
                        <dd></dd>
                    </dl>
                    <dl>
                        <dt>笔记本<i>&gt;</i></dt>
                        <dd>壁挂式空调</dd>
                        <dd>自残</dd>
                        <dd>中央空调</dd>
                        <dd>空调配件</dd>
                    </dl>
                    <dl>
                        <dt>台式机<i>&gt;</i></dt>
                        <dd>规范化</dd>
                        <dd>士大夫</dd>
                        <dd>撒旦撒</dd>
                        <dd>发货</dd>
                    </dl>
                </li>
                <li id="item4">
                    <dl>
                        <dt>家居<i>&gt;</i></dt>
                        <dd>壁挂式空调</dd>
                        <dd>柜式空调</dd>
                        <dd>中央空调</dd>
                        <dd>空调配件</dd>
                    </dl>
                    <dl>
                        <dt>家具<i>&gt;</i></dt>
                        <dd>后台</dd>
                        <dd>宴但</dd>
                        <dd>基金会</dd>
                        <dd>大师傅但</dd>
                    </dl>
                    <dl>
                        <dt>家装<i>&gt;</i></dt>
                        <dd>士大夫</dd>
                        <dd>空间克隆</dd>
                        <dd>是否</dd>
                        <dd>第三方</dd>
                    </dl>
                    <dl>
                        <dt>厨具<i>&gt;</i></dt>
                        <dd>士大夫</dd>
                        <dd>阿凡地方</dd>
                        <dd>是否</dd>
                        <dd>第三方</dd>
                    </dl>
                </li>
            </ul>

        </div>
    </div>

    <script>
        $(function() {
            var activedLi;
            var activedSub;
            var mouseInSub = false;

            $('#sub').on('mouseenter',function(){
                mouseInSub = true;
            }).on('mouseleave',function(){
                mouseInSub = false;
            })

            $('#wrap')
            .on('mouseenter',function(){
                $('#sub').show();
            })
            .on('mouseleave',function(){
                $('#sub').hide();
                $('#main li').removeClass('actived');
                $('#sub li').hide();
            })

            .on('mouseenter','#main li',function(){
                activedLi = $(this)
                activedSub = $('#' + $(this).attr('data-id'));

                //获取鼠标当前坐标和上一次的坐标
                var pointsList = [];
                $(document).off('mousemove').on('mousemove',function(e){
                    pointsList.push({
                        x: e.clientX,
                        y: e.clientY
                    })
                    if(pointsList.length > 2){
                        pointsList.shift()
                    }

                    var p = pointsList[pointsList.length - 1];//当前位置
                    var a = pointsList[0];//move前的位置
                    var b = {
                        x: $('#sub').offset().left,
                        y: $('#sub').offset().top
                    };//二级菜单左上角位置
                    var c = {
                        x: $('#sub').offset().left,
                        y: $('#sub').offset().top + $('#sub').outerHeight()
                    }//二级菜单左下角位置

                    //计算向量
                    var pa = vector(p,a),
                        pb = vector(p,b),
                        pc = vector(p,c);

                    //计算叉乘结果
                    var t1 = vectorProduct(pa,pb),
                        t2 = vectorProduct(pb,pc),
                        t3 = vectorProduct(pc,pa);

                    //判断是否需要延迟
                    if(needDelay(t1,t2,t3)){
                        setTimeout(function(){
                            if(mouseInSub){
                                console.log('a')
                                return
                            }
                            activedLi.addClass('actived')
                            $('#sub li').hide();

                            activedSub.show();
                        },800)
                    }else{
                        if(mouseInSub){
                            return
                        }
                        activedLi.addClass('actived')
                        $('#sub li').hide();

                        activedSub.show();
                    }
                })
            })

            .on('mouseleave','#main li',function(){
                $(this).removeClass('actived')
            })

            .on('mouseenter','#sub li',function(){
                $('[data-id=' + $(this).attr('id') + ']').addClass('actived')
            })

            .on('mouseleave','#sub li',function(){
                $('[data-id=' + $(this).attr('id') + ']').removeClass('actived')
            })
        });


        //向量计算
        function vector(a,b){
            return {
                x: a.x - b.x,
                y: a.y - b.y
            }
        }

        //叉乘计算
        function vectorProduct(v1,v2){
            return v1.x * v2.y - v2.x*v1.y
        }

        //判断是否需要延迟
        function needDelay(a,b,c){
            if((a ^ b) >= 0 && (b ^ c) >=0){
                return true;
            }else{
                return false;
            }
        }
    </script>
</body>
</html>